

Проектная работа по модулю
“SQL и получение данных”


**Итоговая работа** 

**В работе использовался локальный тип подключения.**

**Скриншот ER-диаграммы из DBeaver`a согласно подключения /screenshot/**

**Краткое описание БД - из каких таблиц и представлений состоит.**

**Основной сущностью является бронирование (bookings).**

В одно бронирование можно включить несколько пассажиров, каждому из которых выписывается отдельный билет (tickets). Билет имеет уникальный номер и содержит информацию о пассажире. Как таковой пассажир не является отдельной сущностью. Как имя,так и номер документа пассажира могут меняться с течением времени, так что невозможно однозначно найти все билеты одного человека; для простоты можно считать, что все пассажиры уникальны.

Билет включает один или несколько перелетов (ticket_flights). Несколько перелетов могут включаться в билет в случаях, когда нет нет прямого рейса, соединяющего пункты отправления и назначения (полет с пересадками), либо когда билет взят «туда и обратно». Всхеме данных нет жесткого ограничения, но предполагается, что все билеты в одном бронировании имеют одинаковый набор перелетов.

Каждый рейс (flights) следует из одного аэропорта (airports) в другой. Рейсы с одним номером имеют одинаковые пункты вылета и назначения, но будут отличаться датой отправления.

При регистрации на рейспассажиру выдается посадочный талон (boarding_passes), в которомуказано место в самолете. Пассажир может зарегистрироваться только на тот рейс, который есть у него в билете. Комбинация рейса и места в самолете должна быть уникальной, чтобы не допустить выдачу двух посадочных талонов на одно место.

Количество мест (seats) в самолете и их распределение по классам обслуживания зависит отмодели самолета (aircrafts), выполняющего рейс. Предполагается, что каждая модель самолета имеет только одну компоновку салона. Схема данных не контролирует, что места впосадочных талонах соответствуют имеющимся в самолете (такая проверка может быть сделана с использованием табличных триггеров или в приложении).


- Развернутый анализ БД - описание таблиц, логики, связей и бизнес области (частично можно взять из описания базы данных, оформленной в виде анализа базы данных)


Таблица bookings.aircrafts

Каждая модель воздушного судна идентифицируется своим трехзначным кодом (aircraft_code). Указывается также название модели (model) и максимальная дальность полетав километрах (range).


Таблица bookings.airports

Аэропорт идентифицируется трехбуквенным кодом (airport_code) и имеет свое имя (airport_name).Для города не предусмотрено отдельной сущности, но название (city) указывается и может служить для того, чтобы определить аэропорты одного города. Также указывается широта (longitude), долгота (latitude) и часовой пояс (timezone).


Таблица bookings.boarding_passes

При регистрации на рейс, которая возможна за сутки до плановой даты отправления, пассажиру выдается посадочный талон. Он идентифицируется также, как и перелет — номером билета и номером рейса.Посадочным талонам присваиваются последовательные номера (boarding_no) в порядке регистрации пассажиров на рейс (этот номер будет уникальным только в пределах данного рейса). В посадочном талоне указывается номер места (seat_no)



Таблица bookings.bookings

Пассажир заранее (book_date, максимум за месяц до рейса) бронирует билет себе и, возможно, нескольким другим пассажирам. Бронирование идентифицируется номером (book_ref, шестизначная комбинация букв и цифр).Поле total_amount хранит общую стоимость включенных в бронирование перелетов всех пассажиров.


Таблица bookings.flights

Естественный ключ таблицы рейсов состоит из двух полей — номера рейса (flight_no) и датыотправления (scheduled_departure). Чтобы сделать внешние ключи на эту таблицу компактнее,в качестве первичного используется суррогатный ключ (flight_id).

Рейс всегда соединяет две точки — аэропорты вылета (departure_airport) и прибытия (arrival_airport). Такое понятие, как «рейс с пересадками» отсутствует: если из одного аэропорта до другого нет прямого рейса, в билет просто включаются несколько необходимых рейсов.

У каждого рейса есть запланированные дата и время вылета (scheduled_departure) и прибытия(scheduled_arrival). Реальные время вылета (actual_departure) и прибытия (actual_arrival) могут отличаться: обычно не сильно, но иногда и на несколько часов, если рейс задержан.

Статус рейса (status) может принимать одно из следующих значений:
- Scheduled Рейс доступен для бронирования. Это происходит за месяц до плановой даты вылета; доэтого запись о рейсе не существует в базе данных.
- On TimeРейс доступен для регистрации (за сутки до плановой даты вылета) и не задержан.
- DelayedРейс доступен для регистрации (за сутки до плановой даты вылета), но задержан.
- DepartedСамолет уже вылетел и находится в воздухе.
- ArrivedСамолет прибыл в пункт назначения.
- CancelledРейс отменен.

Таблица bookings.seats

Места определяют схему салона каждой модели. Каждое место определяется своим номером (seat_no) и имеет закрепленный за ним класс обслуживания (fare_conditions) — Economy, Comfort или Business.

Таблица bookings.ticket_flights

Таблица bookings.ticket_flightsПерелет соединяет билет с рейсом и идентифицируется их номерами.Для каждого перелета указываются его стоимость (amount) и класс обслуживания (fare_conditions).

Таблица bookings.tickets

Билет имеет уникальный номер (ticket_no), состоящий из 13 цифр.Билет содержит идентификатор пассажира (passenger_id) — номер документа, удостоверяющего личность, — его фамилию и имя (passenger_name) и контактную информацию (contact_date).Ни идентификатор пассажира, ни имя не являются постоянными (можно поменять паспорт, можно сменить фамилию), поэтому однозначно найти все билеты одного и того же пассажираневозможно.

Представление "bookings.flights_v"

Над таблицей flights создано представление flights_v, содержащее дополнительную информацию:
- расшифровку данных об аэропорте вылета(departure_airport, departure_airport_name, departure_city),
- расшифровку данных об аэропорте прибытия(arrival_airport, arrival_airport_name, arrival_city),
- местное время вылета(scheduled_departure_local, actual_departure_local),
- местное время прибытия(scheduled_arrival_local, actual_arrival_local),
- продолжительность полета(scheduled_duration, actual_duration).

Материализованное представление bookings.routes

Таблица рейсов содержит избыточность: из нее можно было бы выделить информацию омаршруте (номер рейса, аэропорты отправления и назначения), которая не зависит отконкретных дат рейсов.Именно такая информация и составляет материализованное представление routes.



**скрипт  с выполением требуемых запросов с описанием логики - avia.sql** 








